window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(d){window.germanized.admin.shipments={params:{},shipments:{},$wrapper:!1,needsSaving:!1,needsShipments:!0,needsReturns:!1,init:function(){var e=germanized.admin.shipments;e.params=wc_gzd_admin_shipments_params,e.$wrapper=d("#panel-order-shipments"),e.needsShipments=e.$wrapper.find("#order-shipment-add").is(":visible"),e.needsReturns=e.$wrapper.find("#order-return-shipment-add").is(":visible"),e.initShipments(),d(document).ajaxComplete(e.onAjaxComplete),d(document).on("click","#order-shipments-list .shipment-header",e.onToggleShipment).on("change","#order-shipments-list :input:visible",e.setNeedsSaving).on("click","#panel-order-shipments #order-shipment-add",e.onAddShipment).on("click","#panel-order-shipments .remove-shipment",e.onRemoveShipment).on("click","#panel-order-shipments button#order-shipments-save",e.onSave).on("click","#panel-order-shipments .notice-dismiss",e.onRemoveNotice).on("change",".germanized-create-label #product_id",e.onChangeLabelProductId),d(document).on("wc_gzd_admin_shipment_modal_after_submit_success","a#order-return-shipment-add",e.onAddReturnSuccess),d("#panel-order-shipments #order-return-shipment-add").wc_gzd_admin_shipment_modal(),d(document.body).on("init_tooltips",e.initTiptip),e.initTiptip()},onAjaxComplete:function(e,n,i){var t=germanized.admin.shipments;if(null!=n&&i.hasOwnProperty("data")){var n=i.data,i=!1;try{i=JSON.parse('{"'+n.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,n){return""===e?n:decodeURIComponent(n)})}catch(e){i=!1}i&&i.hasOwnProperty("action")&&("woocommerce_save_order_items"!==(n=i.action)&&"woocommerce_remove_order_item"!==n&&"woocommerce_add_order_item"!==n&&"woocommerce_delete_refund"!==n||t.syncItemQuantities())}},syncItemQuantities:function(){var e=germanized.admin.shipments,n=(e.block(),{action:"woocommerce_gzd_validate_shipment_item_quantities",active:e.getActiveShipmentId()});e.doAjax(n,e.onSyncSuccess)},onSyncSuccess:function(e){var n=germanized.admin.shipments;n.unblock(),n.initShipments(),n.initTiptip()},onSave:function(e){var n=germanized.admin.shipments;return e.preventDefault(),n.save(),!1},save:function(){var e=germanized.admin.shipments,n=(e.block(),{action:"woocommerce_gzd_save_shipments",active:e.getActiveShipmentId()});e.doAjax(n,e.onSaveSuccess)},initShipment:function(e){var n=germanized.admin.shipments;n.shipments.hasOwnProperty(e)?n.shipments[e].refreshDom():n.shipments[e]=new d.GermanizedShipment(e)},onSaveSuccess:function(e){var n=germanized.admin.shipments;n.initShipments(),n.setNeedsSaving(!1),n.unblock(),n.initTiptip()},getActiveShipmentId:function(){var e=germanized.admin.shipments.$wrapper.find(".order-shipment.active");return 0<e.length&&e.data("shipment")},block:function(){germanized.admin.shipments.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){germanized.admin.shipments.$wrapper.unblock()},getData:function(e){var n=germanized.admin.shipments,i={};return e=e||{},d.each(n.$wrapper.find(":input[name]").serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),i[n.name]=d.makeArray(i[n.name]),i[n.name].push(n.value)):i[n.name]=n.value}),d.extend(i,e),i},refresh:function(e){var i=germanized.admin.shipments,n=i.getShipment(i.getActiveShipmentId()),t=(current_packaging_id=!1,n&&(current_packaging_id=n.getShipment().find(".shipment-packaging-select").val()),e.hasOwnProperty("order_needs_new_shipments")&&i.setNeedsShipments(e.order_needs_new_shipments),e.hasOwnProperty("order_needs_new_returns")&&i.setNeedsReturns(e.order_needs_new_returns),e.hasOwnProperty("shipments")?e.shipments:{});d.each(i.getShipments(),function(e,n){t.hasOwnProperty(e)&&(n.setIsEditable(t[e].is_editable),n.setNeedsItems(t[e].needs_items),n.setWeight(t[e].weight),n.setLength(t[e].length),n.setWidth(t[e].width),n.setHeight(t[e].height),n.setTotalWeight(t[e].total_weight),i.initShipment(e))}),(e.hasOwnProperty("needs_refresh")||e.hasOwnProperty("needs_packaging_refresh"))&&e.hasOwnProperty("shipment_id")&&(i.initShipment(e.shipment_id),e.hasOwnProperty("needs_packaging_refresh"))&&(n=i.getShipment(i.getActiveShipmentId()))&&(new_packaging_id=n.getShipment().find(".shipment-packaging-select").val())!==current_packaging_id&&i.getShipment(e.shipment_id).refreshDimensions()},doAjax:function(e,n,i){var t=germanized.admin.shipments,r=t.params.ajax_url,s=t.$wrapper,a=!0;s.find(".notice-wrapper").empty(),n=n||t.onAjaxSuccess,i=i||t.onAjaxError,e.hasOwnProperty("refresh_fragments")&&(a=e.refresh_fragments),e.hasOwnProperty("security")||(e.security=t.params.edit_shipments_nonce),e.hasOwnProperty("order_id")||(e.order_id=t.params.order_id),e=t.getData(e),d.ajax({type:"POST",url:r,data:e,success:function(e){e.success?(a&&e.fragments&&d.each(e.fragments,function(e,n){d(e).replaceWith(n),d(e).unblock()}),n.apply(s,[e]),t.refresh(e)):(i.apply(s,[e]),t.unblock(),e.hasOwnProperty("message")?t.addNotice(e.message,"error"):e.hasOwnProperty("messages")&&d.each(e.messages,function(e,n){t.addNotice(n,"error")})),t.initTiptip()},error:function(e){i.apply(s,[e]),t.unblock(),t.initTiptip()},dataType:"json"})},onAjaxError:function(e){},onAjaxSuccess:function(e){},onRemoveNotice:function(){d(this).parents(".notice").slideUp(150,function(){d(this).remove()})},addNotice:function(e,n){germanized.admin.shipments.$wrapper.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},onChangeLabelProductId:function(){germanized.admin.shipments.showOrHideByLabelProduct(d(this).val())},showOrHideByLabelProduct:function(t){d(".germanized-create-label").find("p.form-field :input[data-products-supported]").each(function(){var e=d(this),n=!0,i=e.data("products-supported").split(",");(n=-1!==d.inArray(t,i)?!1:n)?e.parents(".form-field").hide():e.parents(".form-field").show()})},getParams:function(){return germanized.admin.shipments.params},onRemoveShipment:function(){var e=germanized.admin.shipments,n=d(this).parents(".order-shipment").data("shipment");return window.confirm(e.getParams().i18n_remove_shipment_notice)&&e.removeShipment(n),!1},removeShipment:function(e){var n=germanized.admin.shipments,e={action:"woocommerce_gzd_remove_shipment",shipment_id:e};n.block(),n.doAjax(e,n.onRemoveShipmentSuccess,n.onRemoveShipmentError)},onRemoveShipmentSuccess:function(e){var t=germanized.admin.shipments,e=Array.isArray(e.shipment_id)?e.shipment_id:[e.shipment_id];d.each(e,function(e,n){var i=t.$wrapper.find("#shipment-"+n);0<i.length&&(i.hasClass("active")?i.find(".shipment-content-wrapper").slideUp(300,function(){i.removeClass("active"),i.remove(),t.initShipments()}):i.remove())}),t.initShipments(),t.unblock()},onRemoveShipmentError:function(e){germanized.admin.shipments.unblock()},onAddShipment:function(){return germanized.admin.shipments.addShipment(),!1},addShipment:function(){var e=germanized.admin.shipments;e.block(),e.doAjax({action:"woocommerce_gzd_add_shipment"},e.onAddShipmentSuccess,e.onAddShipmentError)},onAddShipmentSuccess:function(e){var n=germanized.admin.shipments;0<n.$wrapper.find(".order-shipment.active").length?n.$wrapper.find(".order-shipment.active").find(".shipment-content-wrapper").slideUp(300,function(){n.$wrapper.find(".order-shipment.active").removeClass("active"),n.appendNewShipment(e),n.initShipments(),n.initTiptip(),n.unblock()}):(n.appendNewShipment(e),n.initShipments(),n.initTiptip(),n.unblock())},appendNewShipment:function(e){var n=germanized.admin.shipments;"simple"===e.new_shipment_type&&0<n.$wrapper.find(".panel-order-return-title").length?n.$wrapper.find(".panel-order-return-title").before(e.new_shipment):n.$wrapper.find("#order-shipments-list").append(e.new_shipment)},onAddShipmentError:function(e){},onAddReturnSuccess:function(e,n){germanized.admin.shipments.onAddShipmentSuccess(n)},setNeedsSaving:function(e){var n=germanized.admin.shipments,i=n.getActiveShipmentId(),i=!!i&&n.getShipment(i).getShipment();n.needsSaving=!0===(e="boolean"!=typeof e?!0:e),n.needsSaving?n.$wrapper.find("#order-shipments-save").show():n.$wrapper.find("#order-shipments-save").hide(),i&&(n.needsSaving?n.disableCreateButtons(i):n.enableCreateButtons(i)),n.hideOrShowFooter(),d(document.body).trigger("woocommerce_gzd_shipments_needs_saving",[n.needsSaving,n.getActiveShipmentId()]),n.initTiptip()},disableCreateButtons:function(e){var n=germanized.admin.shipments,e=e.find(".column-shipment-documents a.wc-gzd-shipment-action-button.create, .column-shipment-documents a.wc-gzd-shipment-action-button.refresh");0<e.length&&(e.addClass("disabled button-disabled"),e.each(function(){d(this).data("org-title",d(this).prop("title")),d(this).prop("title",n.params.i18n_save_before_create)}))},enableCreateButtons:function(e){germanized.admin.shipments;e=e.find(".column-shipment-documents a.wc-gzd-shipment-action-button.create, .column-shipment-documents a.wc-gzd-shipment-action-button.refresh");0<e.length&&(e.removeClass("disabled button-disabled"),e.each(function(){d(this).data("org-title")&&d(this).prop("title",d(this).data("org-title"))}))},setNeedsShipments:function(e){var n=germanized.admin.shipments;n.needsShipments=!0===(e="boolean"!=typeof e?!0:e),n.needsShipments?(n.$wrapper.addClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").show()):(n.$wrapper.removeClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowReturnTitle:function(){var e=germanized.admin.shipments;0===e.$wrapper.find(".order-shipment.shipment-return").length?e.$wrapper.find(".panel-order-return-title").addClass("hide-default"):e.$wrapper.find(".panel-order-return-title").removeClass("hide-default")},setNeedsReturns:function(e){var n=germanized.admin.shipments;n.needsReturns=!0===(e="boolean"!=typeof e?!0:e),n.needsReturns?(n.$wrapper.addClass("needs-returns"),n.$wrapper.find("#order-return-shipment-add").show()):(n.$wrapper.removeClass("needs-returns"),n.$wrapper.find("#order-return-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowFooter:function(){var e=germanized.admin.shipments;e.needsSaving||e.needsShipments||e.needsReturns?e.$wrapper.find(".panel-footer").slideDown(300):e.$wrapper.find(".panel-footer").slideUp(300)},onToggleShipment:function(){var e=germanized.admin.shipments,n=d(this).parents(".order-shipment:first"),i=n.hasClass("active");e.closeShipments(),i||n.find("> .shipment-content-wrapper").slideDown(300,function(){n.addClass("active")})},closeShipments:function(){var e=germanized.admin.shipments;e.$wrapper.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,function(){e.$wrapper.find(".order-shipment.active").removeClass("active")})},initShipments:function(){var n=germanized.admin.shipments;n.$wrapper=d("#panel-order-shipments"),n.$wrapper.find(".order-shipment").each(function(){var e=d(this).data("shipment");n.initShipment(e)}),n.hideOrShowReturnTitle()},getShipments:function(){return germanized.admin.shipments.shipments},getShipment:function(e){var n=germanized.admin.shipments.getShipments();return!!n.hasOwnProperty(e)&&n[e]},initTiptip:function(){var e=germanized.admin.shipments;e.$wrapper.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),e.$wrapper.find(".tip").tipTip({fadeIn:50,fadeOut:50,delay:200}),d(document.body).trigger("shipments_init_tooltips")}},d(document).ready(function(){germanized.admin.shipments.init()})}(jQuery);